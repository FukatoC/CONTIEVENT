<!DOCTYPE html>
<html lang="es">
    <body>
    <div class="container">
      <h1>Perfil</h1>
      <p id="perfil">Bienvenido, {{ nombre }} {{ apellido }}!</p>
      <button type="button" id="btn-cerrar-sesion">Cerrar sesión</button>
    </div>
    <script type="module">
      // Importar las funciones necesarias de los SDKs necesarios
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-analytics.js";
      import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
      import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";
    
      // Configuración de Firebase de la aplicación web
      // Para Firebase JS SDK v7.20.0 y posterior, measurementId es opcional
      const firebaseConfig = {
        apiKey: "AIzaSyB9L3Zp3iMBb-e3WXXUzrbiJMeC4A6TV00",
        authDomain: "conti-event.firebaseapp.com",
        projectId: "conti-event",
        storageBucket: "conti-event.appspot.com",
        messagingSenderId: "1085372616585",
        appId: "1:1085372616585:web:4c0cfc1c12e957b9fc9b58",
        measurementId: "G-W993NSYGBX"
      };
    
      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getDatabase(app);
    
      // Agregar eventos a los botones
      const btnCerrarSesion = document.getElementById("btn-cerrar-sesion");
      if (btnCerrarSesion) {
        btnCerrarSesion.addEventListener("click", cerrarSesion);
      } else {
        console.error("No se encontró el botón de cerrar sesión");
      }
    
      function cerrarSesion() {
        signOut(auth)
          .then(() => {
            // Se ha cerrado sesión
            console.log("Sesión cerrada");
            // Redirigir al usuario a la página de inicio de sesión
            window.location.href = "index.html";
          })
          .catch((error) => {
            // Se ha producido un error
            console.error("Error al cerrar sesión :", error);
          });
      }
    
      // Obtener nombre y apellido del usuario
      const userId = auth.currentUser.uid;
      const userRef = ref(db, `users/${userId}`);
      get(userRef)
        .then((snapshot) => {
          const nombre = snapshot.val().nombre;
          const apellido = snapshot.val().apellido;
          document.getElementById("perfil").innerHTML = `Bienvenido, ${nombre} ${apellido}!`;
        })
        .catch((error) => {
          console.error("Error al obtener nombre y apellido :", error);
        });
    </script>
  </body>
</html>